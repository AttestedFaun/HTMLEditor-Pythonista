<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=100, initial-scale=1"> 
        <title>Editor</title>
        
        <link rel="stylesheet" href="CodeMirror-5.3.0/lib/codemirror.css" type="text/css">
        <link rel="stylesheet" href="CodeMirror-5.3.0/doc/docs.css" type="text/css">
        
        <script src="CodeMirror-5.3.0/lib/codemirror.js" type="text/javascript" rel="javascript"></script>
        <script src="CodeMirror-5.3.0/addon/edit/matchbrackets.js" type="text/javascript" rel="javascript></script>
        <script src="require.js" type="text/javascript" rel="javascript"></script>
        <script src="JSONStringify/stringify.js" type="text/javascript" rel="javascript"></script>
        
        <style type="text/css" media="screen">
            body {
                overflow: hidden;
                -webkit-overflow-scrolling: touch;
                overflow-y:auto;
            }
            .CodeMirror {
                border: 1px solid #eee;
                height: 100%;
            }
        </style>
        <script src="main.js" type="text/javascript" rel="javascript"></script>
        
    </head>
    <body>
        <textarea id="textCTRL"></textarea>
        <script>
            var CM = CodeMirror;
            //console.log(CodeMirror);
            var editor = CodeMirror.fromTextArea(
                                                 document.getElementById("textCTRL"),
                                                 {
                                                    value: "",
                                                    mode: "htmlmixed",
                                                    theme: "default",
                                                    indentUnit: 4,
                                                    smartIndent: true,
                                                    tabSize: 4,
                                                    indentWithTabs: false,
                                                    electricChars: true,
                                                    //spceialChars: \[]\,
                                                    //specialCharPlaceholder: function() {},
                                                    rtlMoveVissually: false,
                                                    keyMap: "default",
                                                    //extraKeys: {},
                                                    lineWrapping: false,
                                                    lineNumbers: true,
                                                    firstLineNumber: 1,
                                                    //lineNumberFormatter: function(line) {return ""},
                                                    //gutters: {},
                                                    fixedGutter: true,
                                                    scrollbarStyle: "native",
                                                    coverGutterNextToScrollbar: false,
                                                    inputStyle: "contenteditable",
                                                    readOnly: false,
                                                    showCursorWhenSelecting: true,
                                                    lineWiseCopyCut: true,
                                                    undoDepth: 250,
                                                    historyEventDelay: 1250,
                                                    //tabIndex: 0,
                                                    autofocus: true,
                                                    dragDrop: true,
                                                    cursorBlinkRate: 530,
                                                    cursorScrollMargin: 0,
                                                    cursorHeight: 1,
                                                    resetSelctionOnContextMenu: true,
                                                    workTime: 200,
                                                    workDelay: 300,
                                                    pollInterval: 100,
                                                    flattenSpans: true,
                                                    addModeClass: true,
                                                    maxHighlightLength: 10000,
                                                    viewportMargin: 100,
                                                    matchBrackets: true,
                                                }
            );
            
            editor.on("change", function(e, a) {
                send_to_python("ios-save", "SAVE");
                console.debug("saving file...");
            });
            
            function loadMode(modename){
                var script = document.createElement("SCRIPT");
                script.setAttribute("src", "CodeMirror-5.3.0/mode/" + modename + "/" + modename + ".js");
                script.setAttribute("type", "text/javascript");
                document.getElementsByTagName("head")[0].appendChild(script);
                console.log("MODE SET");
            }
            
            function printScripts() {
                console.log("LOADED SCRIPTS");
                var head = document.getElementsByTagName("head")[0];
                console.log(stringify(head));
                for (var script in head.scripts) {
                    console.log(script.src);
                }
                console.log("DONE");
            }
            
            console.log(stringify(loadMode));

            loadMode("xml");
            loadMode("javascript");
            loadMode("css");
            loadMode("htmlmixed");
            
            printScripts();
        </script>
    </body>
</html>
